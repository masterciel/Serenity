@{var dotModule = Model.Module == null ? "" : ("." + Model.Module);}

namespace @(Model.RootNamespace)@(dotModule).Endpoints
{
    using Serenity;
    using Serenity.Services;
    using System.Web.Mvc;
    using MyRepository = Repositories.@(Model.ClassName)Repository;
    using MyRow = Entities.@(Model.RowClassName);

    [ServiceAuthorize]
    public class @(Model.ClassName)Controller : Controller
    {
        [AcceptVerbs("POST"), JsonFilter]
        public Result<CreateResponse> Create(SaveRequest<MyRow> request)
        {
            return this.InTransaction("@(Model.Schema)", (uow) => new MyRepository().Create(uow, request));
        }

        [AcceptVerbs("POST"), JsonFilter]
        public Result<UpdateResponse> Update(SaveRequest<MyRow> request)
        {
            return this.InTransaction("@(Model.Schema)", (uow) => new MyRepository().Update(uow, request));
        }
 
        [AcceptVerbs("POST"), JsonFilter]
        public Result<DeleteResponse> Delete(DeleteRequest request)
        {
            return this.InTransaction("@(Model.Schema)", (uow) => new MyRepository().Delete(uow, request));
        }

        [AcceptVerbs("POST"), JsonFilter]
        public Result<UndeleteResponse> Undelete(UndeleteRequest request)
        {
            return this.InTransaction("@(Model.Schema)", (uow) => new MyRepository().Undelete(uow, request));
        }

        [AcceptVerbs("GET", "POST"), JsonFilter]
        public Result<RetrieveResponse<MyRow>> Retrieve(RetrieveRequest request)
        {
            return this.UseConnection("@(Model.Schema)", (cnn) => new MyRepository().Retrieve(cnn, request));
        }

        [AcceptVerbs("GET", "POST"), JsonFilter]
        public Result<ListResponse<MyRow>> List(ListRequest request)
        {
            return this.UseConnection("@(Model.Schema)", (cnn) => new MyRepository().List(cnn, request));
        }
    }
}
